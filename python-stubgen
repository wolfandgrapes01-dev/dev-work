pip install pybind11-stubgen


# 生成 stub 文件
set(OUTPUT_DIR "${CMAKE_BINARY_DIR}/build/release")

add_custom_command(
    TARGET pysharedlib PRE_BUILD
    COMMAND ${CMAKE_COMMAND} -E rm -rf "${OUTPUT_DIR}"
    COMMAND ${CMAKE_COMMAND} -E make_directory "${OUTPUT_DIR}"
    COMMENT "Cleaning output folder before building .pyd"
)

add_custom_command(
    TARGET pysharedlib POST_BUILD
    COMMAND ${Python_EXECUTABLE} -m pybind11_stubgen pysharedlib --output-dir "${OUTPUT_DIR}"
    WORKING_DIRECTORY "${OUTPUT_DIR}"
    COMMENT "Generating .pyi stub for pysharedlib"
)